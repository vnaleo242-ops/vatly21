<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sóng Dọc & Sóng Ngang</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="js/tailwind-config.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.3/p5.js"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Rajdhani:wght@500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/global.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .font-tech {
            font-family: 'Rajdhani', sans-serif;
        }

        input[type=range] {
            -webkit-appearance: none;
            background: transparent;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #06b6d4;
            margin-top: -6px;
            cursor: pointer;
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.5);
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #cbd5e1;
            border-radius: 2px;
        }

        .dark input[type=range]::-webkit-slider-runnable-track {
            background: #475569;
        }

        .hud-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .dark .hud-panel {
            background: rgba(15, 23, 42, 0.85);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
    </style>
</head>

<body
    class="h-screen flex overflow-hidden bg-slate-50 dark:bg-[#0f172a] text-slate-700 dark:text-slate-300 transition-colors duration-300">

    <!-- SIDEBAR -->
    <aside
        class="w-72 flex-shrink-0 flex flex-col bg-white dark:bg-[#1e293b] border-r border-slate-200 dark:border-slate-800 z-20 shadow-lg">
        <div class="h-16 flex items-center justify-between px-6 border-b border-slate-100 dark:border-slate-700/50">
            <h1 class="font-tech font-bold text-xl text-slate-800 dark:text-white uppercase tracking-wider">Control
                Panel</h1>
            <a href="index.html"
                class="p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 text-slate-400 hover:text-cyan-500 transition-colors">
                <i data-lucide="home" class="w-5 h-5"></i>
            </a>
        </div>

        <div class="flex-1 overflow-y-auto p-6 space-y-8 custom-scrollbar">

            <!-- Wave Type -->
            <div>
                <label
                    class="text-xs font-bold text-slate-400 dark:text-slate-500 uppercase tracking-widest mb-3 block">Loại
                    Sóng</label>
                <div class="grid grid-cols-2 gap-2 bg-slate-100 dark:bg-slate-800 p-1 rounded-lg">
                    <button id="btnTransverse"
                        class="px-3 py-2 rounded-md text-sm font-semibold transition-all shadow-sm bg-white dark:bg-slate-700 text-cyan-600 dark:text-cyan-400 ring-1 ring-black/5 dark:ring-white/10">
                        Sóng Ngang
                    </button>
                    <button id="btnLongitudinal"
                        class="px-3 py-2 rounded-md text-sm font-medium text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-750 transition-all">
                        Sóng Dọc
                    </button>
                </div>
            </div>

            <!-- Parameters -->
            <div class="space-y-6">
                <div>
                    <div class="flex justify-between text-xs mb-1.5">
                        <label class="font-medium text-slate-600 dark:text-slate-300">Biên độ (A)</label>
                        <span class="font-mono text-cyan-600 dark:text-cyan-400"><span id="ampDisplay">50</span>
                            mm</span>
                    </div>
                    <input type="range" id="ampSlider" min="10" max="150" value="50" step="1" class="w-full">
                </div>

                <div>
                    <div class="flex justify-between text-xs mb-1.5">
                        <label class="font-medium text-slate-600 dark:text-slate-300">Tần số (f)</label>
                        <span class="font-mono text-cyan-600 dark:text-cyan-400"><span id="freqDisplay">1.0</span>
                            Hz</span>
                    </div>
                    <input type="range" id="freqSlider" min="0.1" max="5.0" value="1.0" step="0.1" class="w-full">
                </div>
            </div>

            <!-- Description Box -->
            <div id="descPanel"
                class="p-4 bg-slate-100 dark:bg-slate-800/50 rounded-lg text-xs leading-relaxed text-slate-600 dark:text-slate-400 border border-slate-200 dark:border-slate-700">
                <!-- Content injected via JS -->
            </div>

        </div>

        <!-- Footer -->
        <div class="p-4 border-t border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-900/50">
            <button onclick="toggleDarkMode()"
                class="w-full flex items-center justify-center gap-2 py-2 rounded-lg text-slate-500 hover:bg-slate-200 dark:hover:bg-slate-800 transition">
                <i id="theme-icon" data-lucide="moon" class="w-4 h-4"></i>
                <span class="text-xs font-medium uppercase">Toggle Theme</span>
            </button>
        </div>
    </aside>

    <!-- MAIN -->
    <main class="flex-1 relative bg-white dark:bg-[#0f172a] overflow-hidden flex flex-col">
        <div id="p5-container" class="flex-1 relative overflow-hidden">
            <!-- P5 Canvas will correspond here -->

            <!-- HUD -->
            <div class="absolute top-4 right-4 hud-panel rounded-xl p-3 shadow-xl z-10 backdrop-blur-md min-w-[150px]">
                <div
                    class="text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-2 border-b border-slate-200 dark:border-slate-700 pb-1">
                    Trạng thái</div>
                <div class="space-y-1 font-mono text-xs">
                    <div class="flex justify-between items-center text-cyan-600 dark:text-cyan-400">
                        <span>Type:</span>
                        <span id="hudType" class="font-bold">Ngang</span>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="js/theme.js"></script>
    <script>
        // --- GLOBAL State ---
        let waveType = 'transverse';
        let angle = 0;
        const particleCount = 60;
        const keyPointPositions = [0.1, 0.3, 0.5, 0.7, 0.9];
        const highlightIndices = [5, 15, 30, 45, 55];

        // UI Refs
        const ampSlider = document.getElementById('ampSlider');
        const freqSlider = document.getElementById('freqSlider');
        const ampDisplay = document.getElementById('ampDisplay');
        const freqDisplay = document.getElementById('freqDisplay');
        const descPanel = document.getElementById('descPanel');
        const hudType = document.getElementById('hudType');

        const btnTransverse = document.getElementById('btnTransverse');
        const btnLongitudinal = document.getElementById('btnLongitudinal');

        // Styles
        const activeClass = "px-3 py-2 rounded-md text-sm font-semibold transition-all shadow-sm bg-white dark:bg-slate-700 text-cyan-600 dark:text-cyan-400 ring-1 ring-black/5 dark:ring-white/10";
        const inactiveClass = "px-3 py-2 rounded-md text-sm font-medium text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-750 transition-all";

        function updateUI() {
            ampDisplay.innerText = ampSlider.value;
            freqDisplay.innerText = parseFloat(freqSlider.value).toFixed(1);
            hudType.innerText = waveType === 'transverse' ? 'Ngang' : 'Dọc';

            if (waveType === 'transverse') {
                btnTransverse.className = activeClass;
                btnLongitudinal.className = inactiveClass;
                descPanel.innerHTML = `
                    <strong class="text-cyan-600 dark:text-cyan-400 block mb-1">SÓNG NGANG (Transverse)</strong>
                    Các phần tử môi trường dao động <strong class="text-slate-800 dark:text-slate-200">vuông góc</strong> với phương truyền sóng.
                    <br><br>
                    <span class="inline-block w-2 h-2 rounded-full bg-yellow-400 mr-1"></span> Các điểm quan sát dao động lên xuống.
                `;
            } else {
                btnTransverse.className = inactiveClass;
                btnLongitudinal.className = activeClass;
                descPanel.innerHTML = `
                    <strong class="text-pink-600 dark:text-pink-400 block mb-1">SÓNG DỌC (Longitudinal)</strong>
                    Các phần tử môi trường dao động <strong class="text-slate-800 dark:text-slate-200">trùng phương</strong> với phương truyền sóng.
                    <br><br>
                    <span class="inline-block w-2 h-2 rounded-full bg-green-400 mr-1"></span> Các điểm quan sát nén/giãn trên trục ngang.
                `;
            }
        }

        btnTransverse.onclick = () => { waveType = 'transverse'; angle = 0; updateUI(); }
        btnLongitudinal.onclick = () => { waveType = 'longitudinal'; angle = 0; updateUI(); }

        ampSlider.oninput = updateUI;
        freqSlider.oninput = updateUI;

        // --- P5.js ---
        function setup() {
            const container = document.getElementById('p5-container');
            const canvas = createCanvas(container.clientWidth, container.clientHeight);
            canvas.parent('p5-container');
            updateUI();
        }

        function windowResized() {
            const container = document.getElementById('p5-container');
            resizeCanvas(container.clientWidth, container.clientHeight);
        }

        function draw() {
            const A = parseFloat(ampSlider.value);
            const f = parseFloat(freqSlider.value);

            // Theme colors
            const isDark = document.documentElement.className.includes('dark') || localStorage.getItem('theme') === 'dark'; // Check tailwind
            // Actually tailwind `dark` class is on html tag
            const htmlDark = document.documentElement.classList.contains('dark');

            if (htmlDark) background(15, 23, 42); else background(255);

            angle += f * 0.1;

            if (waveType === 'transverse') drawTransverse(A, f, htmlDark);
            else drawLongitudinal(A, f, htmlDark);
        }

        function drawTransverse(A, f, isDark) {
            const yCenter = height / 2;
            const wlFactor = 0.02; // Wavelength factor scaling with width

            // Grid Lines
            stroke(isDark ? 40 : 220); strokeWeight(1);
            line(0, yCenter, width, yCenter); // Ox

            // Amplitude Guides
            drawingContext.setLineDash([4, 4]);
            stroke(isDark ? 60 : 200);
            line(0, yCenter - A, width, yCenter - A);
            line(0, yCenter + A, width, yCenter + A);
            drawingContext.setLineDash([]);

            // Wave
            stroke(isDark ? '#22d3ee' : '#0891b2'); // Cyan-400 / Cyan-600
            strokeWeight(3); noFill();
            beginShape();
            for (let x = 0; x <= width; x += 5) {
                const y = yCenter + A * sin(x * wlFactor - angle);
                vertex(x, y);
            }
            endShape();

            // Particles
            for (let pct of keyPointPositions) {
                const x = width * pct;
                const y = yCenter + A * sin(x * wlFactor - angle);

                // Guide Line
                stroke(236, 72, 153); // Pink-500
                strokeWeight(1);
                line(x, yCenter, x, y);

                // Point
                stroke(isDark ? 255 : 0); strokeWeight(2);
                fill(250, 204, 21); // Yellow-400
                circle(x, y, 12);
            }
        }

        function drawLongitudinal(A, f, isDark) {
            const yCenter = height / 2;
            const separation = width / (particleCount + 1);
            const maxDisp = A * 0.8;
            const wlFactor = 0.1;

            // Grid Lines
            stroke(isDark ? 40 : 220); strokeWeight(1);
            line(0, yCenter, width, yCenter); // Ox

            for (let i = 0; i < particleCount; i++) {
                const eqX = (i + 1) * separation;
                const disp = maxDisp * sin(eqX * wlFactor - angle);
                const curX = eqX + disp;

                const isHighlight = highlightIndices.includes(i);

                if (isHighlight) {
                    // Guide Lines for Equil (Magenta) and Current (Cyan)
                    drawingContext.setLineDash([2, 4]);
                    stroke(236, 72, 153); strokeWeight(1);
                    line(eqX, yCenter - 20, eqX, yCenter + 20);

                    stroke(34, 211, 238);
                    line(curX, yCenter - 20, curX, yCenter + 20);
                    drawingContext.setLineDash([]);

                    // Highlight Particle
                    stroke(isDark ? 255 : 0); strokeWeight(2);
                    fill(74, 222, 128); // Green-400
                    circle(curX, yCenter, 14);

                } else {
                    // Background Particle
                    noStroke();
                    // Color Fade based on disp
                    const alpha = map(abs(disp), 0, maxDisp, 50, 200);
                    fill(239, 68, 68, alpha); // Red-500
                    circle(curX, yCenter, 6);
                }
            }
        }

        // Icons
        lucide.createIcons();
    </script>
</body>

</html>